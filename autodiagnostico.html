<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Autodiagn√≥stico ¬∑ Matem√°tica a Pedal</title>

  <!-- Estilo global -->
  <link rel="stylesheet" href="https://utec-math.github.io/matematica-a-pedal/assets/style.css?v=3">

  <!-- MathJax -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['\\(', '\\)'], ['$', '$']],
        displayMath: [['\\[','\\]'], ['$$','$$']]
      }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  <style>
    .ad-intro {
      background: linear-gradient(90deg,#FFD580,#FFA559);
      border-radius: 14px;
      padding: 20px;
      border: 2px solid #fff;
      box-shadow: 0 6px 16px rgba(0,0,0,.08);
      margin-top: 16px;
    }
    .ad-card {
      border: 1px solid #FFD580;
      border-radius: 12px;
      padding: 14px;
      margin-top: 18px;
      background: #FFFDF7;
    }
    .ad-card h2 {
      margin-top: 0;
      color: #783f04;
    }
    .ad-question {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px dashed #FFE0A8;
    }
    .ad-options label {
      display: block;
      margin: 3px 0;
      cursor: pointer;
      padding: 2px 4px;
      border-radius: 6px;
      transition: background 0.2s, box-shadow 0.2s;
    }
    .ad-actions {
      margin-top: 18px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .ad-actions button {
      cursor: pointer;
      color: #783f04;
      background: #fff;
      border: 1px solid #FFD580;
      border-radius: 10px;
      padding: 8px 12px;
      font-family: 'Roboto Mono', monospace;
    }
    .ad-result {
      margin-top: 18px;
      border: 1px solid #FFD580;
      border-radius: 12px;
      padding: 14px;
      background: #FFF6E6;
    }

    /* Resaltado de correcci√≥n */
    .ad-correct {
      background: #EFFFF2;
      box-shadow: 0 0 0 1px #9BE7B0;
    }
    .ad-incorrect {
      background: #FFECEC;
      box-shadow: 0 0 0 1px #F5A3A3;
    }
    .ad-mark {
      font-size: 0.9em;
      margin-left: 6px;
    }

    /* Pregunta enfocada (primera incorrecta/sin responder) */
    .ad-question-focus {
      box-shadow: 0 0 0 2px #FFA559;
      border-radius: 10px;
      padding: 10px;
      margin-top: 14px;
    }

    /* Layout con barra lateral izquierda con bici */
    #autodiag-home {
      position: relative;
      padding-left: 280px; /* deja espacio para la barra lateral en pantallas grandes */
    }

    #autodiag-progress-wrapper {
      position: fixed;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      width: 250px;
      z-index: 40;
    }

    /* En pantallas chicas, la barra vuelve arriba del contenido */
    @media (max-width: 1024px) {
      #autodiag-home {
        padding-left: 0;
      }
      #autodiag-progress-wrapper {
        position: static;
        transform: none;
        width: auto;
        margin-top: 16px;
      }
    }

    /* Modo impresi√≥n: ocultar barra lateral para PDF m√°s limpio */
    @media print {
      #autodiag-progress-wrapper {
        display: none;
      }
      #autodiag-home {
        padding-left: 0;
      }
    }
  </style>
</head>

<body>

  <!-- Encabezado compartido -->
  <div id="header-placeholder"></div>
  <script src="/matematica-a-pedal/assets/load-header.js"></script>

  <!-- CONTENIDO AUTODIAGN√ìSTICO -->
  <main id="autodiag-home" style="font-family:'Roboto Mono', monospace; color:#7f6000; line-height:1.55; max-width:1180px; margin:0 auto;">

    <!-- Intro -->
    <section class="ad-intro">
      <h1 style="color:#783f04; margin:0; font-size:30px;">Autodiagn√≥stico de Matem√°tica a Pedal</h1>
      <p style="margin:8px 0 0;">
        Este autodiagn√≥stico te ayuda a ubicar por d√≥nde conviene empezar a pedalear üßÆüö≤  
        No es una prueba calificable, sino una herramienta para saber qu√© unidades requieren m√°s repaso.
      </p>
      <p style="margin:8px 0 0;">
        Respond√© sin calculadora si es posible. Al final vas a ver tu resultado global y sugerencias por tema
        (Calentamiento, Conjuntos y Operaciones, Factorizaci√≥n, Trigonometr√≠a y Potencias/Notaci√≥n Cient√≠fica).
      </p>
    </section>

    <!-- Barra con bici en el margen izquierdo (progress-bar-bike.js rellena dentro de #unit-progress) -->
    <div id="autodiag-progress-wrapper">
      <div id="unit-progress"></div>
    </div>

    <section id="autodiag-form" class="ad-card">
      <h2>Indicaciones generales</h2>
      <p style="margin-top:0;">
        Marc√° una sola opci√≥n en cada ejercicio. Si no est√°s seguro, eleg√≠ la que te parezca m√°s razonable:
        eso tambi√©n es informaci√≥n √∫til sobre tu nivel actual.
      </p>
    </section>

    <!-- BLOQUE U0 ¬∑ CALENTAMIENTO -->
    <section class="ad-card">
      <h2>Bloque A ‚Äî Calentamiento matem√°tico (U0)</h2>

      <!-- Q1 -->
      <div class="ad-question">
        <p><b>1.</b> El n√∫mero \( \sqrt{2} \) es:</p>
        <div class="ad-options">
          <label><input type="radio" name="q1" value="a"> Natural y racional.</label>
          <label><input type="radio" name="q1" value="b"> Entero pero no racional.</label>
          <label><input type="radio" name="q1" value="c"> Real e irracional.</label>
          <label><input type="radio" name="q1" value="d"> Un n√∫mero imaginario.</label>
        </div>
      </div>

      <!-- Q2 -->
      <div class="ad-question">
        <p><b>2.</b> Calcul√° \( \dfrac{3}{4} + \dfrac{5}{6} \).</p>
        <div class="ad-options">
          <label><input type="radio" name="q2" value="a"> \( \dfrac{8}{10} \)</label>
          <label><input type="radio" name="q2" value="b"> \( \dfrac{19}{12} \)</label>
          <label><input type="radio" name="q2" value="c"> \( \dfrac{7}{10} \)</label>
          <label><input type="radio" name="q2" value="d"> \( \dfrac{23}{24} \)</label>
        </div>
      </div>

      <!-- Q3 -->
      <div class="ad-question">
        <p><b>3.</b> Orden√° de menor a mayor: \( -2, \; -\dfrac{1}{2}, \; 0, \; 1{,}5 \).</p>
        <div class="ad-options">
          <label><input type="radio" name="q3" value="a"> \( -2 &lt; 0 &lt; -\dfrac{1}{2} &lt; 1{,}5 \)</label>
          <label><input type="radio" name="q3" value="b"> \( -2 &lt; -\dfrac{1}{2} &lt; 0 &lt; 1{,}5 \)</label>
          <label><input type="radio" name="q3" value="c"> \( -\dfrac{1}{2} &lt; -2 &lt; 0 &lt; 1{,}5 \)</label>
          <label><input type="radio" name="q3" value="d"> \( 0 &lt; -2 &lt; -\dfrac{1}{2} &lt; 1{,}5 \)</label>
        </div>
      </div>

      <!-- Q4 -->
      <div class="ad-question">
        <p><b>4.</b> El resultado de \( (-3)^2 - 4\cdot 2 \) es:</p>
        <div class="ad-options">
          <label><input type="radio" name="q4" value="a"> \( -17 \)</label>
          <label><input type="radio" name="q4" value="b"> \( 1 \)</label>
          <label><input type="radio" name="q4" value="c"> \( 25 \)</label>
          <label><input type="radio" name="q4" value="d"> \( 5 \)</label>
        </div>
      </div>
    </section>

    <!-- BLOQUE U1 ¬∑ CONJUNTOS Y OPERACIONES -->
    <section class="ad-card">
      <h2>Bloque B ‚Äî Conjuntos num√©ricos y operaciones b√°sicas (U1)</h2>

      <!-- Q5 -->
      <div class="ad-question">
        <p><b>5.</b> ¬øCu√°l de las siguientes afirmaciones es verdadera?</p>
        <div class="ad-options">
          <label><input type="radio" name="q5" value="a"> \( \mathbb{N} \subset \mathbb{Z} \subset \mathbb{Q} \subset \mathbb{R} \)</label>
          <label><input type="radio" name="q5" value="b"> \( \mathbb{Q} \subset \mathbb{Z} \subset \mathbb{R} \subset \mathbb{N} \)</label>
          <label><input type="radio" name="q5" value="c"> \( \mathbb{Z} \subset \mathbb{N} \subset \mathbb{Q} \subset \mathbb{R} \)</label>
          <label><input type="radio" name="q5" value="d"> \( \mathbb{R} \subset \mathbb{Q} \subset \mathbb{Z} \subset \mathbb{N} \)</label>
        </div>
      </div>

      <!-- Q6 -->
      <div class="ad-question">
        <p><b>6.</b> Aplicando la propiedad distributiva, el valor de \( 3(2x - 5) - (x - 1) \) es:</p>
        <div class="ad-options">
          <label><input type="radio" name="q6" value="a"> \( 7x - 16 \)</label>
          <label><input type="radio" name="q6" value="b"> \( 5x - 14 \)</label>
          <label><input type="radio" name="q6" value="c"> \( 6x - 15 - x + 1 \)</label>
          <label><input type="radio" name="q6" value="d"> \( 5x - 16 \)</label>
        </div>
      </div>

      <!-- Q7 -->
      <div class="ad-question">
        <p><b>7.</b> Calcul√° \( \dfrac{5}{8} - \dfrac{3}{10} \).</p>
        <div class="ad-options">
          <label><input type="radio" name="q7" value="a"> \( \dfrac{1}{40} \)</label>
          <label><input type="radio" name="q7" value="b"> \( \dfrac{7}{40} \)</label>
          <label><input type="radio" name="q7" value="c"> \( \dfrac{13}{40} \)</label>
          <label><input type="radio" name="q7" value="d"> \( \dfrac{19}{40} \)</label>
        </div>
      </div>

      <!-- Q8 -->
      <div class="ad-question">
        <p><b>8.</b> ¬øCu√°l de las siguientes expresiones es equivalente a \( -(-a + 3b) \)?</p>
        <div class="ad-options">
          <label><input type="radio" name="q8" value="a"> \( -a - 3b \)</label>
          <label><input type="radio" name="q8" value="b"> \( a - 3b \)</label>
          <label><input type="radio" name="q8" value="c"> \( a + 3b \)</label>
          <label><input type="radio" name="q8" value="d"> \( -a + 3b \)</label>
        </div>
      </div>
    </section>

    <!-- BLOQUE U2 ¬∑ FACTORIZACI√ìN -->
    <section class="ad-card">
      <h2>Bloque C ‚Äî Factorizaci√≥n y expresiones algebraicas (U2)</h2>

      <!-- Q9 -->
      <div class="ad-question">
        <p><b>9.</b> Factoriz√° \( x^2 - 9 \).</p>
        <div class="ad-options">
          <label><input type="radio" name="q9" value="a"> \( (x - 3)^2 \)</label>
          <label><input type="radio" name="q9" value="b"> \( (x - 9)(x + 1) \)</label>
          <label><input type="radio" name="q9" value="c"> \( (x - 3)(x + 3) \)</label>
          <label><input type="radio" name="q9" value="d"> \( x(x - 9) \)</label>
        </div>
      </div>

      <!-- Q10 -->
      <div class="ad-question">
        <p><b>10.</b> El desarrollo de \( (x + 2)^2 \) es:</p>
        <div class="ad-options">
          <label><input type="radio" name="q10" value="a"> \( x^2 + 4 \)</label>
          <label><input type="radio" name="q10" value="b"> \( x^2 + 2x + 4 \)</label>
          <label><input type="radio" name="q10" value="c"> \( x^2 + 4x + 4 \)</label>
          <label><input type="radio" name="q10" value="d"> \( x^2 + 2x + 2 \)</label>
        </div>
      </div>

      <!-- Q11 -->
      <div class="ad-question">
        <p><b>11.</b> Simplific√° la fracci√≥n algebraica \( \dfrac{6x^2}{9x} \) (con \( x \neq 0 \)).</p>
        <div class="ad-options">
          <label><input type="radio" name="q11" value="a"> \( \dfrac{2x}{3} \)</label>
          <label><input type="radio" name="q11" value="b"> \( \dfrac{2x^2}{3} \)</label>
          <label><input type="radio" name="q11" value="c"> \( \dfrac{6x}{9} \)</label>
          <label><input type="radio" name="q11" value="d"> \( \dfrac{3x}{2} \)</label>
        </div>
      </div>

      <!-- Q12 -->
      <div class="ad-question">
        <p><b>12.</b> Factor com√∫n: \( 5x^3 - 10x^2 \) se puede escribir como:</p>
        <div class="ad-options">
          <label><input type="radio" name="q12" value="a"> \( 5x^2(x - 2) \)</label>
          <label><input type="radio" name="q12" value="b"> \( 5x(x^2 - 2) \)</label>
          <label><input type="radio" name="q12" value="c"> \( x^2(5x - 10) \)</label>
          <label><input type="radio" name="q12" value="d"> \( 5(x^3 - 2x^2) \)</label>
        </div>
      </div>
    </section>

    <!-- BLOQUE U3 ¬∑ TRIGONOMETR√çA -->
    <section class="ad-card">
      <h2>Bloque D ‚Äî Trigonometr√≠a (U3)</h2>

      <!-- Q13 -->
      <div class="ad-question">
        <p><b>13.</b> Expres√° \( 150^\circ \) en radianes.</p>
        <div class="ad-options">
          <label><input type="radio" name="q13" value="a"> \( \dfrac{\pi}{3} \)</label>
          <label><input type="radio" name="q13" value="b"> \( \dfrac{5\pi}{6} \)</label>
          <label><input type="radio" name="q13" value="c"> \( \dfrac{2\pi}{3} \)</label>
          <label><input type="radio" name="q13" value="d"> \( \dfrac{3\pi}{4} \)</label>
        </div>
      </div>

      <!-- Q14 -->
      <div class="ad-question">
        <p><b>14.</b> El valor de \( \sin\left(\dfrac{\pi}{6}\right) \) es:</p>
        <div class="ad-options">
          <label><input type="radio" name="q14" value="a"> \( \dfrac{\sqrt{3}}{2} \)</label>
          <label><input type="radio" name="q14" value="b"> \( \dfrac{1}{2} \)</label>
          <label><input type="radio" name="q14" value="c"> \( \dfrac{\sqrt{2}}{2} \)</label>
          <label><input type="radio" name="q14" value="d"> 1</label>
        </div>
      </div>

      <!-- Q15 -->
      <div class="ad-question">
        <p><b>15.</b> En un tri√°ngulo rect√°ngulo, el √°ngulo agudo mide \( 30^\circ \) y la hipotenusa mide 10. 
        La longitud del cateto opuesto a ese √°ngulo es:</p>
        <div class="ad-options">
          <label><input type="radio" name="q15" value="a"> 5</label>
          <label><input type="radio" name="q15" value="b"> \( 5\sqrt{3} \)</label>
          <label><input type="radio" name="q15" value="c"> 10</label>
          <label><input type="radio" name="q15" value="d"> \( \dfrac{10}{\sqrt{3}} \)</label>
        </div>
      </div>

      <!-- Q16 -->
      <div class="ad-question">
        <p><b>16.</b> Una funci√≥n sinusoidal tiene per√≠odo \( T = 4 \) segundos. ¬øCu√°l es su frecuencia?</p>
        <div class="ad-options">
          <label><input type="radio" name="q16" value="a"> \( 4 \,\text{Hz} \)</label>
          <label><input type="radio" name="q16" value="b"> \( \dfrac{1}{4} \,\text{Hz} \)</label>
          <label><input type="radio" name="q16" value="c"> \( 2 \,\text{Hz} \)</label>
          <label><input type="radio" name="q16" value="d"> \( \dfrac{1}{2} \,\text{Hz} \)</label>
        </div>
      </div>
    </section>

    <!-- BLOQUE U4 ¬∑ POTENCIACI√ìN Y NOTACI√ìN CIENT√çFICA -->
    <section class="ad-card">
      <h2>Bloque E ‚Äî Potencias, ra√≠ces y notaci√≥n cient√≠fica (U4)</h2>

      <!-- Q17 -->
      <div class="ad-question">
        <p><b>17.</b> Calcul√° \( 2^3 \cdot 2^4 \).</p>
        <div class="ad-options">
          <label><input type="radio" name="q17" value="a"> \( 2^7 = 128 \)</label>
          <label><input type="radio" name="q17" value="b"> \( 2^{12} = 4096 \)</label>
          <label><input type="radio" name="q17" value="c"> \( 2^{1} = 2 \)</label>
          <label><input type="radio" name="q17" value="d"> \( 2^{4} \cdot 2^{3} = 24 \)</label>
        </div>
      </div>

      <!-- Q18 -->
      <div class="ad-question">
        <p><b>18.</b> El valor de \( \sqrt[3]{8} \) es:</p>
        <div class="ad-options">
          <label><input type="radio" name="q18" value="a"> 2</label>
          <label><input type="radio" name="q18" value="b"> 4</label>
          <label><input type="radio" name="q18" value="c"> \( \sqrt{8} \)</label>
          <label><input type="radio" name="q18" value="d"> \( \dfrac{1}{2} \)</label>
        </div>
      </div>

      <!-- Q19 -->
      <div class="ad-question">
        <p><b>19.</b> Escrib√≠ \( 0{,}00045 \) en notaci√≥n cient√≠fica.</p>
        <div class="ad-options">
          <label><input type="radio" name="q19" value="a"> \( 4{,}5 \times 10^{-3} \)</label>
          <label><input type="radio" name="q19" value="b"> \( 4{,}5 \times 10^{-4} \)</label>
          <label><input type="radio" name="q19" value="c"> \( 45 \times 10^{-5} \)</label>
          <label><input type="radio" name="q19" value="d"> \( 0{,}45 \times 10^{-4} \)</label>
        </div>
      </div>

      <!-- Q20 -->
      <div class="ad-question">
        <p><b>20.</b> El n√∫mero \( 5 \times 10^{-2} \) es igual a:</p>
        <div class="ad-options">
          <label><input type="radio" name="q20" value="a"> 0,5</label>
          <label><input type="radio" name="q20" value="b"> 0,05</label>
          <label><input type="radio" name="q20" value="c"> 5</label>
          <label><input type="radio" name="q20" value="d"> \( 5 \times 100 \)</label>
        </div>
      </div>
    </section>

    <!-- Botones y resultados -->
    <section class="ad-card">
      <h2>Resultados</h2>
      <p>Cuando termines, hac√© clic en <b>Corregir</b>. Pod√©s borrar tus respuestas con <b>Reset</b> o guardar en PDF.</p>
      <div class="ad-actions">
        <button id="ad-submit" type="button">‚úÖ Corregir autodiagn√≥stico</button>
        <button id="ad-reset" type="button">üîÑ Reset respuestas</button>
        <button id="ad-print" type="button">üñ®Ô∏è Imprimir / guardar como PDF</button>
      </div>
      <div id="ad-result" class="ad-result">
        <p style="margin:0; opacity:.8;">Aqu√≠ aparecer√°n tus resultados globales y sugerencias por tema.</p>
      </div>
    </section>

  </main>

  <!-- Firebase + Auth -->
  <script type="module" src="/matematica-a-pedal/assets/firebase-init.js"></script>
  <script type="module" src="/matematica-a-pedal/assets/progress-sync.js"></script>

  <!-- Barra de progreso con bicicleta (componente general del sitio) -->
  <script src="/matematica-a-pedal/assets/progress-bar-bike.js"></script>

  <!-- L√≥gica del autodiagn√≥stico + actualizaci√≥n de barra con bici -->
  <script>
  (function(){
    // Clave de respuestas correctas (seg√∫n tu lista por bloque)
    const answerKey = {
      q1: 'c',
      q2: 'b',
      q3: 'b',
      q4: 'b',
      q5: 'a',
      q6: 'b',
      q7: 'c',
      q8: 'b',
      q9: 'c',
      q10:'c',
      q11:'a',
      q12:'a',
      q13:'b',
      q14:'b',
      q15:'a',
      q16:'b',
      q17:'a',
      q18:'a',
      q19:'b',
      q20:'b'
    };

    // Mapa pregunta -> tema/unidad
    const topicMap = {
      q1: 'U0', q2: 'U0', q3: 'U0', q4: 'U0',
      q5: 'U1', q6: 'U1', q7: 'U1', q8: 'U1',
      q9: 'U2', q10:'U2', q11:'U2', q12:'U2',
      q13:'U3', q14:'U3', q15:'U3', q16:'U3',
      q17:'U4', q18:'U4', q19:'U4', q20:'U4'
    };

    const topicLabels = {
      U0: 'Calentamiento matem√°tico (Unidad 0)',
      U1: 'Conjuntos y operaciones b√°sicas (Unidad 1)',
      U2: 'Factorizaci√≥n y expresiones algebraicas (Unidad 2)',
      U3: 'Trigonometr√≠a (Unidad 3)',
      U4: 'Potenciaci√≥n, radicaci√≥n y notaci√≥n cient√≠fica (Unidad 4)'
    };

    const submitBtn = document.getElementById('ad-submit');
    const resetBtn  = document.getElementById('ad-reset');
    const printBtn  = document.getElementById('ad-print');
    const resultBox = document.getElementById('ad-result');

    const questions   = Array.from(document.querySelectorAll('.ad-question'));
    const allRadios   = document.querySelectorAll('#autodiag-home input[type="radio"]');

    // Elementos de la barra con bici dentro de #unit-progress
    const progressRoot  = document.getElementById('unit-progress');
    const progressFill  = progressRoot ? progressRoot.querySelector('[class*="fill"]')   : null;
    const progressBike  = progressRoot ? progressRoot.querySelector('[class*="bike"]')   : null;
    const progressLabel = progressRoot ? progressRoot.querySelector('[class*="label"]')  : null;

    function limpiarMarcas(){
      document.querySelectorAll('.ad-question').forEach(q => {
        q.classList.remove('ad-question-focus');
      });
      document.querySelectorAll('.ad-options label').forEach(lab => {
        lab.classList.remove('ad-correct','ad-incorrect');
        const mark = lab.querySelector('.ad-mark');
        if (mark) mark.remove();
      });
    }

    // -------- Barra con bici: porcentaje de preguntas respondidas --------
    function updateProgress(){
      const total = questions.length || 1;
      let answered = 0;
      questions.forEach(q => {
        if (q.querySelector('input[type="radio"]:checked')) answered++;
      });
      const pct = Math.round(100 * answered / total);

      if (progressFill){
        progressFill.style.width = pct + '%';
      }
      if (progressBike){
        progressBike.style.left = pct + '%';
      }
      if (progressLabel){
        progressLabel.textContent = pct + '%';
      }
    }

    // -------- Correcci√≥n del autodiagn√≥stico --------
    function corregir(){
      limpiarMarcas();

      let total = 0;
      let correct = 0;
      const topicTotals  = {};
      const topicCorrect = {};
      let firstProblemQuestion = null; // primera incorrecta o sin responder

      for (const qid in answerKey){
        total++;
        const radios = document.querySelectorAll('input[name="'+qid+'"]');
        let chosen = null;
        radios.forEach(r => { if (r.checked) chosen = r.value; });

        const topic = topicMap[qid];
        topicTotals[topic]  = (topicTotals[topic]  || 0) + 1;

        const correctValue = answerKey[qid];
        const correctInput = document.querySelector('input[name="'+qid+'"][value="'+correctValue+'"]');
        const correctLabel = correctInput ? correctInput.closest('label') : null;

        if (correctLabel){
          correctLabel.classList.add('ad-correct');
          const span = document.createElement('span');
          span.className = 'ad-mark';
          span.textContent = '‚úî';
          correctLabel.appendChild(span);
        }

        const questionDiv = radios[0] ? radios[0].closest('.ad-question') : null;

        if (chosen === correctValue){
          correct++;
          topicCorrect[topic] = (topicCorrect[topic] || 0) + 1;
        } else {
          if (chosen){
            const chosenInput = document.querySelector('input[name="'+qid+'"][value="'+chosen+'"]');
            const chosenLabel = chosenInput ? chosenInput.closest('label') : null;
            if (chosenLabel){
              chosenLabel.classList.add('ad-incorrect');
              const span = document.createElement('span');
              span.className = 'ad-mark';
              span.textContent = '‚úñ';
              chosenLabel.appendChild(span);
            }
          }
          if (!firstProblemQuestion && questionDiv){
            firstProblemQuestion = questionDiv;
          }
        }
      }

      if (total === 0) return;

      const pctGlobal = Math.round(100 * correct / total);
      let html = '';

      html += `<p><b>Resultado global:</b> ${correct} de ${total} √≠tems correctos (${pctGlobal}%).</p>`;

      let mensajeNivel = '';
      if (pctGlobal >= 80){
        mensajeNivel = 'Buen nivel general. Pod√©s usar las unidades sobre todo para afianzar y profundizar.';
      } else if (pctGlobal >= 50){
        mensajeNivel = 'Nivel intermedio. Conviene repasar algunas unidades con m√°s detalle.';
      } else {
        mensajeNivel = 'Te recomendamos comenzar despacio por las primeras unidades y usar los ejemplos guiados.';
      }
      html += `<p>${mensajeNivel}</p>`;

      html += `<h3 style="color:#783f04; margin-top:12px;">Sugerencias por tema</h3><ul>`;
      Object.keys(topicTotals).sort().forEach(t => {
        const tot = topicTotals[t];
        const ok  = topicCorrect[t] || 0;
        const pct = Math.round(100 * ok / tot);
        let msg;
        if (pct >= 80){
          msg = 'Buen dominio. Pod√©s avanzar con confianza.';
        } else if (pct >= 50){
          msg = 'Nivel medio. Vale la pena repasar esta unidad mientras la curs√°s.';
        } else {
          msg = 'Conviene trabajar esta unidad con calma (videos, ejemplos y ejercicios guiados).';
        }
        html += `<li><b>${topicLabels[t]}</b>: ${ok}/${tot} (${pct}%). ${msg}</li>`;
      });
      html += `</ul>`;

      resultBox.innerHTML = html;

      if (firstProblemQuestion){
        firstProblemQuestion.classList.add('ad-question-focus');
        firstProblemQuestion.scrollIntoView({behavior:'smooth', block:'center'});
      } else {
        resultBox.scrollIntoView({behavior:'smooth', block:'start'});
      }
    }

    function resetear(){
      if (!confirm('¬øBorrar tus respuestas del autodiagn√≥stico?')) return;
      document.querySelectorAll('#autodiag-home input[type="radio"]').forEach(r => r.checked = false);
      limpiarMarcas();
      resultBox.innerHTML = '<p style="margin:0; opacity:.8;">Aqu√≠ aparecer√°n tus resultados globales y sugerencias por tema.</p>';
      updateProgress();
    }

    function imprimirPDF(){
      window.print();
    }

    submitBtn.addEventListener('click', corregir);
    resetBtn.addEventListener('click', resetear);
    printBtn.addEventListener('click', imprimirPDF);

    allRadios.forEach(r => r.addEventListener('change', updateProgress));

    // Estado inicial de la barra
    updateProgress();
  })();
  </script>

</body>
</html>
